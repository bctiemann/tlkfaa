{% load static %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<%@ page language="java" contentType="text/html; charset=UTF-8" session="true" %>
<%@ page import="java.security.*,java.math.*,java.util.*,java.nio.charset.StandardCharsets,javax.crypto.*,javax.crypto.spec.*" %>
<%@ page trimDirectiveWhitespaces="true" %>

<%@ taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>

<sql:setDataSource dataSource="jdbc/Fanart" />

<jsp:include page="inc_root/inc_session.jsp" />


<c:set var="tab" value="${tab}" />
<%
String theUrl = request.getRequestURI();
String[] urlPath = theUrl.split("/");
String thisPage = "";
String tab = (String)pageContext.getAttribute("tab");
String tabPage = "";
String pageTitle = "";
boolean doGrass = false;
if (urlPath.length == 4 && urlPath[1].equals("Artists")) {
  pageContext.setAttribute("artistdir",urlPath[urlPath.length-2]);
} else if (urlPath.length > 2) {
  thisPage = urlPath[urlPath.length-2];
  pageContext.setAttribute("artistdir",urlPath[urlPath.length-1]);
} else if (urlPath.length > 1) {
  thisPage = urlPath[urlPath.length-1];
}
if (thisPage.equals("index.jsp")) {
  thisPage = "";
}
tabPage = thisPage;
if (thisPage.equals("FavoritePictures.jsp")
  || thisPage.equals("Picture.jsp")
//  || thisPage.equals("Character.jsp")
  || thisPage.equals("ArtWall.jsp")
  || thisPage.equals("Contests.jsp")) {
  tabPage = "Artwork";
}
if (tabPage.equals("") 
  || tabPage.equals("Artists") 
  || tabPage.equals("Artists.jsp") 
  || tabPage.equals("Artwork") 
  || tabPage.equals("Special") 
  || tabPage.equals("Characters") 
  || tabPage.equals("TradingTree.jsp") 
  || tabPage.equals("ColoringCave.jsp")) {
  doGrass = true;
}
if (tab != null) {
    doGrass = true;
}

if (thisPage.equals("ColoringCave.jsp")) { pageTitle = "Coloring Cave"; }
if (thisPage.equals("TradingTree.jsp")) { pageTitle = "Trading Tree"; }
if (thisPage.equals("ArtWall.jsp")) { pageTitle = "ArtWall"; }
if (thisPage.equals("Contests.jsp")) { pageTitle = "Contests"; }
pageContext.setAttribute("thisPage",thisPage);
pageContext.setAttribute("tabPage",tabPage);
%>

<c:if test="${artistdir != null}">
	<sql:query var="qryArtist">
	SELECT *
	FROM artists
	WHERE dirname=?
	<sql:param value="${artistdir}" />
	</sql:query>
	<c:forEach var="pageartist" items="${qryArtist.rows}">
		<c:set var="thisartist" scope="page" value="${pageartist}" />
		<c:set var="thisartistname" value="${thisartist.artistname}" />
		<%
		  pageTitle = (String)pageContext.getAttribute("thisartistname");
		%>
		<%--
		<c:set var="artistid" scope="session" value="${row.artistid}" />
		<c:set var="artistname" scope="session" value="${row.name}" />
		<c:set var="artistdir" scope="session" value="${artistdir}" />
		--%>
	</c:forEach>
</c:if>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
	<title>The Lion King Fan-Art Archive<% if (pageTitle != "") { out.print(" &mdash; "); } %><%= pageTitle %></title>
	<link title="TLKFAA" rel="stylesheet" href="{% static "css/style.css" %}" />

<!--	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>-->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<!--	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>-->
<%--
	<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
--%>

<%--
	<link href="/css/custom-theme/jquery-ui-1.8.9.custom.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="/js/jquery-ui-1.8.9.custom.min.js"></script>
--%>
	<link href="{% static "jquery-ui-1.12.0.custom/jquery-ui.css" %}" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="{% static "jquery-ui-1.12.0.custom/jquery-ui.min.js" %}"></script>

<%--	<script type="text/javascript" src="/js/jquery.js"></script>
	<script type="text/javascript" src="/js/jquery.autocomplete.js"></script>--%>
	<script type="text/javascript" src="/js/jquery.popmenu.js"></script>
	<script type="text/javascript" src="/js/ajaxfileupload.js"></script>
	<script type="text/javascript" src="/js/jquery.masonry.min.js"></script>
	<script type="text/javascript" src="/js/jquery.tagsinput.js"></script>
<%--	<script type="text/javascript" src="/js/wtooltip.min.js"></script>--%>
	<script type="text/javascript" src="/js/tooltip.js"></script>
	<script type="text/javascript" src="/js/tlkfaa.js"></script>
	<script type="text/javascript" src="/js/cookies.js"></script>
	<script type="text/javascript" src="/js/md5.js"></script>
	<script type="text/javascript" src="/js/he.js"></script>

	<script type="text/javascript" src="/js/xregexp-min.js"></script>
	<script type="text/javascript" src="/js/xregexp-unicode-base.js"></script>

	<script src='https://www.google.com/recaptcha/api.js'></script>

	<link rel="stylesheet" href="/css/tooltip.css" />
	<link rel="stylesheet" href="/css/jquery.tagsinput.css" />
	<link rel="stylesheet" href="/css/video-js.css" />
	<link rel="stylesheet" href="/shadowbox/shadowbox.css" />
	<script type="text/javascript" src="/shadowbox/shadowbox.js"></script>
	<!--[if lt IE 8]>
	<link rel="stylesheet" href="/css/ie7fix.css" />
	<![endif]-->
</head>
<body>

<div class="wrapper">

<div class="top"><img id="simba" src="/images/AdultSimba.gif" /></div>

<div class="header">
	<div class="logo">
	<a href="/"><img src="/images/fanart-header.png" /></a>
	</div>
	<div class="logolegend">A <a href="http://www.lionking.org">lionking.org</a> site</div>
</div>
<div class="simbabottom"></div>

<table class="layout">
<tr>

<!--content pane-->
<td>

<%--<div class="prop"></div>--%>

<ul id="tabs">
    <li class="tab main <c:if test="${tabPage == ''}">active</c:if>">
        <a href="/"><%--<img id="tab_main" src="/images/tab-main-<% if (tabPage.equals("")) { %>active<% } else { %>inactive<% } %>.png" />--%></a>
    </li>
    <li class="tab artists <c:if test="${tabPage == 'Artists.jsp' || tabPage == 'Artists'}">active</c:if>">
        <a href="/Artists.jsp"><%--<img id="tab_artists" src="/images/tab-artists-<% if (tabPage.equals("Artists")) { %>active<% } else { %>inactive<% } %>.png" />--%></a>
    </li>
    <li class="tab artwork <c:if test="${tabPage == 'Artwork' || tab == 'artwork'}">active</c:if>">
        <a href="/Artwork/"><%--<img id="tab_artwork" src="/images/tab-artwork-<% if (tabPage.equals("Artwork")) { %>active<% } else { %>inactive<% } %>.png" />--%>
        <c:if test="${newpics_count > 0}">
            <div class="newpics-badge">${newpics_count}</div>
        </c:if>
        </a>
    </li>
    <li class="tab characters <c:if test="${tabPage == 'Characters'}">active</c:if>">
        <a href="/Characters/"><%--<img id="tab_characters" src="/images/tab-characters-<% if (tabPage.equals("Characters")) { %>active<% } else { %>inactive<% } %>.png" />--%></a>
    </li>
    <li class="tab tradingtree <c:if test="${tabPage == 'TradingTree.jsp'}">active</c:if>">
        <a href="/TradingTree.jsp"><%--<img id="tab_tradingtree" src="/images/tab-tradingtree-<% if (tabPage.equals("TradingTree.jsp")) { %>active<% } else { %>inactive<% } %>.png" />--%></a>
    </li>
    <li class="tab coloringcave <c:if test="${tabPage == 'ColoringCave.jsp'}">active</c:if>">
        <a href="/ColoringCave.jsp"><%--<img id="tab_coloringcave" src="/images/tab-coloringcave-<% if (tabPage.equals("ColoringCave.jsp")) { %>active<% } else { %>inactive<% } %>.png" />--%></a>
    </li>
    <li class="tab special <c:if test="${tabPage == 'Special'}">active</c:if>">
        <a href="/Special/"><%--<img id="tab_special" src="/images/tab-special-<% if (tabPage.equals("Special")) { %>active<% } else { %>inactive<% } %>.png" />--%></a>
    </li>
</ul>

<table class="contentpane">
<tr>
<td class="left"><div class="spacer"></div></td>
<td class="content">
<% if (doGrass == true) { %>

<div class="grasswrap">
<div class="grass">

<c:set var="bodyTopMargin" scope="page" value="0" />

<c:choose>
<c:when test="${tabPage == ''}">
<%--<img src="/images/ground-main.png" />--%>
    <div class="tab main">
    </div>
</c:when>
<c:when test="${tabPage == 'Artists'}">
    <img src="/images/ground-artists.png" />
    <c:set var="bodyTopMargin" scope="page" value="0" />
</c:when>
<c:when test="${tabPage == 'Artists.jsp'}">
    <img src="/images/ground-artists.png" />
    <c:set var="bodyTopMargin" scope="page" value="0" />
</c:when>
<c:when test="${tabPage == 'Artwork' || tab == 'artwork'}">
    <img src="/images/ground-artwork.png" />
    <c:set var="bodyTopMargin" scope="page" value="1" />
</c:when>
<c:when test="${tabPage == 'Characters'}">
    <img src="/images/ground-characters.png" />
    <c:set var="bodyTopMargin" scope="page" value="1" />
</c:when>
<c:when test="${tabPage == 'TradingTree.jsp'}">
    <img src="/images/ground-tradingtree.png" />
    <c:set var="bodyTopMargin" scope="page" value="1" />
</c:when>
<c:when test="${tabPage == 'ColoringCave.jsp'}">
<%--    <img src="/images/ground-coloringcave.png" />--%>
    <c:set var="bodyTopMargin" scope="page" value="1" />
</c:when>
<c:when test="${tabPage == 'Special'}">
<%--    <img src="/images/ground-special.png" />--%>
    <c:set var="bodyTopMargin" scope="page" value="1" />
</c:when>
</c:choose>
<%--<img src="/images/ground-<% if (thisPage.equals("")) { %>1<% } else if (thisPage.equals("Artists")) { %>2<% } else if (thisPage.equals("Artwork")) { %>3<% } else if (thisPage.equals("Special")) { %>4<% } %>.jpg" />--%>

<% if (thisPage.equals("")) { %>

<div class="pagesummary" style="margin-left: 130px; margin-right: 10px">
<sql:query var="qryCache">
SELECT numartists,numpictures FROM cache
</sql:query>

<c:forEach var="row" items="${qryCache.rows}">
<b>fanart.lionking.org</b> is the largest collection of
<i>Lion King</i> fan artwork on the Internet, currently featuring
<b><fmt:formatNumber type="number" value="${row.numartists}" /></b> artists with a total of 
<b><fmt:formatNumber type="number" value="${row.numpictures}" /></b> published
pictures inspired by Disney's <i>Lion King</i> universe.
</c:forEach>
</div>

<% } else if (thisPage.equals("Artists")) { %>

<%--
<div class="pagesummary" style="margin-left: 230px; margin-right: 10px">
On this page you can look up artists alphabetically or by any of several other methods, revisiting old favorites or discovering new ones.
</div>
--%>

<% } else if (thisPage.equals("Artists.jsp")) { %>

<% } else if (thisPage.equals("Artwork")) { %>

<%--
<div class="pagesummary" style="margin-left: 10px; margin-right: 285px; width: 300px">
On this page you'll find recently uploaded and widely acclaimed artwork, as well as randomly selected pictures, which you can add to your Favorite Pictures album.
</div>
--%>

<% } else if (thisPage.equals("Special")) { %>

<%--
<div class="pagesummary" style="margin-left: 10px; margin-right: 180px; width: 400px">
This page contains special sections where our artists have created art to commemorate specific events, as well as the site-wide Art Contest.
</div>
--%>

<% } %>

    <div class="grass-tile"></div>
</div>
<div class="grassspacer"></div>
<%--<div class="grassgradient"></div>--%>
</div>

<% } %>

<div class="body<% if (doGrass == false) { %> utilpage<% } %>">
<div class="bodyprop <c:if test="${bodyTopMargin == 1}">tall</c:if>"></div>

<div class="dialog" id="dialog_confirm" title="Confirmation">
	<p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span><span id="dialog_confirm_text">Are you sure?</span></p>
</div>


{% block content %}{% endblock %}


<%--
inc_lowerlayout.jsp
Structural component which goes after the main content pane's contents and defines the beginning of the right column (inc_userpane.jsp).
--%>

<!--<br clear="left" />-->
</div>
 
</td>
<td class="right"><div class="spacer"></div></td>
</tr>
<tr>
<td class="bottomleft"></td>
<td class="bottom"><div class="spacer"></div></td>
<td class="bottomright"></td>
</tr> 
</table>

</td>




<!--Right Column-->
<td class="userpane">

<%--
inc_userpane.jsp
Structural component which contains all the userboxes in the right column.
--%>

<%@ page language="java" contentType="text/html; charset=UTF-8" %>

<%@ taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>

<sql:setDataSource dataSource="jdbc/Fanart" />

<div id="genstatus"></div>


<div class="userbox">
<div class="userboxinner" id="loginbox">

<c:choose>
<c:when test="${loggedin == 1}">

<p>
Logged in as 
<c:choose>
<c:when test="${artist.active == true}">
<a href="/Artists/${artist.dirname}/">${artist.artistname}</a>
</c:when>
<c:otherwise>
${artist.artistname}
</c:otherwise>
</c:choose>
</p>

<a class="button smallbutton" href="/ArtManager.jsp"><c:choose><c:when test="${artist.active == true}">ArtManager</c:when><c:otherwise>Profile</c:otherwise></c:choose></a>
<a class="button smallbutton" href="javascript:nop()" onclick="doLogout()">Log out</a>

<sql:query var="qryPMs">
SELECT * FROM pms
WHERE recptid=?
AND viewed=false
<sql:param value="${user.userid}" />
</sql:query>
<c:choose>
<c:when test="${qryPMs.rowCount > 0}">
<div class="unread-pms">${qryPMs.rowCount} unread PM<c:if test="${qryPMs.rowCount != 1}">s</c:if></div>
</c:when>
<c:otherwise>
<div class="unread-pms no-unread">No unread PMs</div>
</c:otherwise>
</c:choose>

<c:set var="loggedin" scope="session" value="1" />

</c:when>
<c:otherwise>

<form name="loginform" method="post" action="/Picture.jsp" onSubmit="return doLogin()">

<table class="formtable">
<tr>
<td class="label">Artist login</td>
<td class="data"><input type="text" name="artistlogin" id="artistlogin" /></td>
</tr>
<tr>
<td class="label">Password</td>
<td class="data"><input type="password" name="artistpasswd" id="artistpasswd" /></td>
</tr>
<tr>
<td colspan="2" class="buttons">
<button type="submit" class="small">Log In</button>
<a class="button smallbutton lightbutton" href="/Register.jsp">Register</a>
<a class="button smallbutton lightbutton" href="/Recovery.jsp">Forgot?</a>
</td>
</tr>
</table>

</form>

<c:set var="loggedin" scope="session" value="0" />

</c:otherwise>
</c:choose>

</div>
</div>


<c:if test="${loggedin == 1}">

<div class="userbox">
<h1>
<a id="favoriteartistsbox_toggle" class="toggle <c:choose><c:when test="${user.showfavoriteartistsbox == true}">toggleopen</c:when><c:otherwise>toggleclosed</c:otherwise></c:choose>" href="javascript:nop()" onclick="toggleUserBox('favoriteartistsbox')"></a>
Favorite Artists</h1>
<div class="userboxinner <c:if test="${user.showfavoriteartistsbox == false}">hidden</c:if>" id="favoriteartistsbox">

<c:choose>
<c:when test="${user.showfavoriteartistsbox == true}">
<%@include file="ajax_favoriteartistsbox.jsp"%>
<script type="text/javascript">
showUserBox["favoriteartistsbox"] = 1;
</script>
</c:when>
<c:otherwise>
<script type="text/javascript">
showUserBox["favoriteartistsbox"] = 0;
</script>
</c:otherwise>
</c:choose>

</div>
<div class="userboxfooter">
<sql:query var="qryFavoritesAll">
SELECT * FROM favorites
WHERE userid=?
<sql:param value="${user.userid}" />
</sql:query>
${qryFavoritesAll.rowCount} artists watched
</div>
</div>


<div class="userbox">
<h1>
<a id="favoritepicturesbox_toggle" class="toggle <c:choose><c:when test="${user.showfavoritepicturesbox == true}">toggleopen</c:when><c:otherwise>toggleclosed</c:otherwise></c:choose>" href="javascript:nop()" onclick="toggleUserBox('favoritepicturesbox')"></a>
Favorite Pictures</h1>
<div class="userboxinner <c:if test="${user.showfavoritepicturesbox == false}">hidden</c:if>" id="favoritepicturesbox">

<c:choose>
<c:when test="${user.showfavoritepicturesbox == true}">
<jsp:include page="/ajax_favoritepicturesbox.jsp" />
<script type="text/javascript">
showUserBox["favoritepicturesbox"] = 1;
</script>
</c:when>
<c:otherwise>
<script type="text/javascript">
showUserBox["favoritepicturesbox"] = 0;
</script>
</c:otherwise>
</c:choose>

</div>
<div class="userboxfooter">
<sql:query var="qryFavePicsAll">
SELECT * FROM favepics,artists
WHERE favepics.userid=?
AND favepics.artistid=artists.artistid
AND enabled=true
AND active=true
<sql:param value="${user.userid}" />
</sql:query>
<a href="/FavoritePictures.jsp">View All ${qryFavePicsAll.rowCount}</a>
</div>
</div>


<div class="userbox">
<h1>
<a id="sketcherbox_toggle" class="toggle <c:choose><c:when test="${user.showsketcherbox == true}">toggleopen</c:when><c:otherwise>toggleclosed</c:otherwise></c:choose>" href="javascript:nop()" onclick="toggleUserBox('sketcherbox')"></a>
Sketcher</h1>
<div class="userboxinner <c:if test="${user.showsketcherbox == false}">hidden</c:if>" id="sketcherbox">

<c:choose>
<c:when test="${user.showsketcherbox == true}">
<jsp:include page="/ajax_sketcherbox.jsp" />
<script type="text/javascript">
showUserBox["sketcherbox"] = 1;
</script>
</c:when>
<c:otherwise>
<script type="text/javascript">
showUserBox["sketcherbox"] = 0;
</script>
</c:otherwise>
</c:choose>

</div>
<div class="userboxfooter">
<a href="/Sketcher/">Sketcher</a>
</div>
</div>


<div class="userbox">
<h1>
<a id="communityartbox_toggle"class="toggle <c:choose><c:when test="${user.showcommunityartbox == true}">toggleopen</c:when><c:otherwise>toggleclosed</c:otherwise></c:choose>" href="javascript:nop()" onclick="toggleUserBox('communityartbox')"></a>
Community Art</h1>
<div class="userboxinner <c:if test="${user.showcommunityartbox == false}">hidden</c:if>" id="communityartbox">

<c:choose>
<c:when test="${user.showcommunityartbox == true}">
<jsp:include page="/ajax_communityartbox.jsp" />
<script type="text/javascript">
showUserBox["communityartbox"] = 1;
</script>
</c:when>
<c:otherwise>
<script type="text/javascript">
showUserBox["communityartbox"] = 0;
</script>
</c:otherwise>
</c:choose>

</div>
<div class="userboxfooter">
<a href="/TradingTree.jsp">Trading Tree</a>
<a href="/ColoringCave.jsp">Coloring Cave</a>
</div>
</div>


<div class="userbox">
<h1>
<a id="contestsbox_toggle"class="toggle <c:choose><c:when test="${user.showcontestsbox == true}">toggleopen</c:when><c:otherwise>toggleclosed</c:otherwise></c:choose>" href="javascript:nop()" onclick="toggleUserBox('contestsbox')"></a>
Art Contests</h1>
<div class="userboxinner <c:if test="${user.showcontestsbox == false}">hidden</c:if>" id="contestsbox">

<c:choose>
<c:when test="${user.showcontestsbox == true}">
<jsp:include page="/ajax_contestsbox.jsp" />
<script type="text/javascript">
showUserBox["contestsbox"] = 1;
</script>
</c:when>
<c:otherwise>
<script type="text/javascript">
showUserBox["contestsbox"] = 0;
</script>
</c:otherwise>
</c:choose>

</div>
<div class="userboxfooter">
<a href="/Contests.jsp">Contests</a>
</div>
</div>


<div class="userbox">
<h1>
<a id="toolbox_toggle" class="toggle <c:choose><c:when test="${user.showtoolbox == true}">toggleopen</c:when><c:otherwise>toggleclosed</c:otherwise></c:choose>" href="javascript:nop()" onclick="toggleUserBox('toolbox')"></a>
Toolbox</h1>
<div class="userboxinner <c:if test="${user.showtoolbox == false}">hidden</c:if>" id="toolbox">

<c:choose>
<c:when test="${user.showtoolbox == true}">
<jsp:include page="/ajax_toolbox.jsp" />
<script type="text/javascript">
showUserBox["toolbox"] = 1;
</script>
</c:when>
<c:otherwise>
<script type="text/javascript">
showUserBox["toolbox"] = 0;
</script>
</c:otherwise>
</c:choose>

</div>
<div class="userboxfooter"></div>
</div>

</c:if>



</td>
</tr>
</table>

<%--
inc_footer.jsp
Structural component containing the sticky footer.
--%>

<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>

</div>

<%
  pageContext.setAttribute("now", new java.util.Date());
%>

<div class="footer">
	<ul>
	<li><a href="/pop_about.jsp" rel="shadowbox;width=500;height=600">About</a></li>
	<li><a href="/pop_tos.jsp" rel="shadowbox;width=750;height=600">Terms of Use / Guidelines</a></li>
	<li><a href="/pop_privacy.jsp" rel="shadowbox;width=500;height=600">Privacy Policy</a></li>
	<li><a href="/pop_help.jsp" rel="shadowbox;width=500;height=600">Help</a></li>
	</ul>
	<div class="footertext">
	<p>Web design &copy; 1995-<fmt:formatDate value="${now}" pattern="yyyy"/> <a href="mailto:btman@lionking.org">Brian Tiemann</a></p>
	</div>
</div>

</body>
</html>

