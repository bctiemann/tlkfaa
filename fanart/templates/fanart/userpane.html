<%--
inc_userpane.jsp
Structural component which contains all the userboxes in the right column.
--%>

<%@ page language="java" contentType="text/html; charset=UTF-8" %>

<%@ taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>

<sql:setDataSource dataSource="jdbc/Fanart" />

<div id="genstatus"></div>


<div class="userbox">
<div class="userboxinner" id="loginbox">

<c:choose>
<c:when test="${loggedin == 1}">

<p>
Logged in as 
<c:choose>
<c:when test="${artist.active == true}">
<a href="/Artists/${artist.dirname}/">${artist.artistname}</a>
</c:when>
<c:otherwise>
${artist.artistname}
</c:otherwise>
</c:choose>
</p>

<a class="button smallbutton" href="/ArtManager.jsp"><c:choose><c:when test="${artist.active == true}">ArtManager</c:when><c:otherwise>Profile</c:otherwise></c:choose></a>
<a class="button smallbutton" href="javascript:nop()" onclick="doLogout()">Log out</a>

<sql:query var="qryPMs">
SELECT * FROM pms
WHERE recptid=?
AND viewed=false
<sql:param value="${user.userid}" />
</sql:query>
<c:choose>
<c:when test="${qryPMs.rowCount > 0}">
<div class="unread-pms">${qryPMs.rowCount} unread PM<c:if test="${qryPMs.rowCount != 1}">s</c:if></div>
</c:when>
<c:otherwise>
<div class="unread-pms no-unread">No unread PMs</div>
</c:otherwise>
</c:choose>

<c:set var="loggedin" scope="session" value="1" />

</c:when>
<c:otherwise>

<form name="loginform" method="post" action="/Picture.jsp" onSubmit="return doLogin()">

<table class="formtable">
<tr>
<td class="label">Artist login</td>
<td class="data"><input type="text" name="artistlogin" id="artistlogin" /></td>
</tr>
<tr>
<td class="label">Password</td>
<td class="data"><input type="password" name="artistpasswd" id="artistpasswd" /></td>
</tr>
<tr>
<td colspan="2" class="buttons">
<button type="submit" class="small">Log In</button>
<a class="button smallbutton lightbutton" href="/Register.jsp">Register</a>
<a class="button smallbutton lightbutton" href="/Recovery.jsp">Forgot?</a>
</td>
</tr>
</table>

</form>

<c:set var="loggedin" scope="session" value="0" />

</c:otherwise>
</c:choose>

</div>
</div>


<c:if test="${loggedin == 1}">

<div class="userbox">
<h1>
<a id="favoriteartistsbox_toggle" class="toggle <c:choose><c:when test="${user.showfavoriteartistsbox == true}">toggleopen</c:when><c:otherwise>toggleclosed</c:otherwise></c:choose>" href="javascript:nop()" onclick="toggleUserBox('favoriteartistsbox')"></a>
Favorite Artists</h1>
<div class="userboxinner <c:if test="${user.showfavoriteartistsbox == false}">hidden</c:if>" id="favoriteartistsbox">

<c:choose>
<c:when test="${user.showfavoriteartistsbox == true}">
<%@include file="ajax_favoriteartistsbox.jsp"%>
<script type="text/javascript">
showUserBox["favoriteartistsbox"] = 1;
</script>
</c:when>
<c:otherwise>
<script type="text/javascript">
showUserBox["favoriteartistsbox"] = 0;
</script>
</c:otherwise>
</c:choose>

</div>
<div class="userboxfooter">
<sql:query var="qryFavoritesAll">
SELECT * FROM favorites
WHERE userid=?
<sql:param value="${user.userid}" />
</sql:query>
${qryFavoritesAll.rowCount} artists watched
</div>
</div>


<div class="userbox">
<h1>
<a id="favoritepicturesbox_toggle" class="toggle <c:choose><c:when test="${user.showfavoritepicturesbox == true}">toggleopen</c:when><c:otherwise>toggleclosed</c:otherwise></c:choose>" href="javascript:nop()" onclick="toggleUserBox('favoritepicturesbox')"></a>
Favorite Pictures</h1>
<div class="userboxinner <c:if test="${user.showfavoritepicturesbox == false}">hidden</c:if>" id="favoritepicturesbox">

<c:choose>
<c:when test="${user.showfavoritepicturesbox == true}">
<jsp:include page="/ajax_favoritepicturesbox.jsp" />
<script type="text/javascript">
showUserBox["favoritepicturesbox"] = 1;
</script>
</c:when>
<c:otherwise>
<script type="text/javascript">
showUserBox["favoritepicturesbox"] = 0;
</script>
</c:otherwise>
</c:choose>

</div>
<div class="userboxfooter">
<sql:query var="qryFavePicsAll">
SELECT * FROM favepics,artists
WHERE favepics.userid=?
AND favepics.artistid=artists.artistid
AND enabled=true
AND active=true
<sql:param value="${user.userid}" />
</sql:query>
<a href="/FavoritePictures.jsp">View All ${qryFavePicsAll.rowCount}</a>
</div>
</div>


<div class="userbox">
<h1>
<a id="sketcherbox_toggle" class="toggle <c:choose><c:when test="${user.showsketcherbox == true}">toggleopen</c:when><c:otherwise>toggleclosed</c:otherwise></c:choose>" href="javascript:nop()" onclick="toggleUserBox('sketcherbox')"></a>
Sketcher</h1>
<div class="userboxinner <c:if test="${user.showsketcherbox == false}">hidden</c:if>" id="sketcherbox">

<c:choose>
<c:when test="${user.showsketcherbox == true}">
<jsp:include page="/ajax_sketcherbox.jsp" />
<script type="text/javascript">
showUserBox["sketcherbox"] = 1;
</script>
</c:when>
<c:otherwise>
<script type="text/javascript">
showUserBox["sketcherbox"] = 0;
</script>
</c:otherwise>
</c:choose>

</div>
<div class="userboxfooter">
<a href="/Sketcher/">Sketcher</a>
</div>
</div>


<div class="userbox">
<h1>
<a id="communityartbox_toggle"class="toggle <c:choose><c:when test="${user.showcommunityartbox == true}">toggleopen</c:when><c:otherwise>toggleclosed</c:otherwise></c:choose>" href="javascript:nop()" onclick="toggleUserBox('communityartbox')"></a>
Community Art</h1>
<div class="userboxinner <c:if test="${user.showcommunityartbox == false}">hidden</c:if>" id="communityartbox">

<c:choose>
<c:when test="${user.showcommunityartbox == true}">
<jsp:include page="/ajax_communityartbox.jsp" />
<script type="text/javascript">
showUserBox["communityartbox"] = 1;
</script>
</c:when>
<c:otherwise>
<script type="text/javascript">
showUserBox["communityartbox"] = 0;
</script>
</c:otherwise>
</c:choose>

</div>
<div class="userboxfooter">
<a href="/TradingTree.jsp">Trading Tree</a>
<a href="/ColoringCave.jsp">Coloring Cave</a>
</div>
</div>


<div class="userbox">
<h1>
<a id="contestsbox_toggle"class="toggle <c:choose><c:when test="${user.showcontestsbox == true}">toggleopen</c:when><c:otherwise>toggleclosed</c:otherwise></c:choose>" href="javascript:nop()" onclick="toggleUserBox('contestsbox')"></a>
Art Contests</h1>
<div class="userboxinner <c:if test="${user.showcontestsbox == false}">hidden</c:if>" id="contestsbox">

<c:choose>
<c:when test="${user.showcontestsbox == true}">
<jsp:include page="/ajax_contestsbox.jsp" />
<script type="text/javascript">
showUserBox["contestsbox"] = 1;
</script>
</c:when>
<c:otherwise>
<script type="text/javascript">
showUserBox["contestsbox"] = 0;
</script>
</c:otherwise>
</c:choose>

</div>
<div class="userboxfooter">
<a href="/Contests.jsp">Contests</a>
</div>
</div>


<div class="userbox">
<h1>
<a id="toolbox_toggle" class="toggle <c:choose><c:when test="${user.showtoolbox == true}">toggleopen</c:when><c:otherwise>toggleclosed</c:otherwise></c:choose>" href="javascript:nop()" onclick="toggleUserBox('toolbox')"></a>
Toolbox</h1>
<div class="userboxinner <c:if test="${user.showtoolbox == false}">hidden</c:if>" id="toolbox">

<c:choose>
<c:when test="${user.showtoolbox == true}">
<jsp:include page="/ajax_toolbox.jsp" />
<script type="text/javascript">
showUserBox["toolbox"] = 1;
</script>
</c:when>
<c:otherwise>
<script type="text/javascript">
showUserBox["toolbox"] = 0;
</script>
</c:otherwise>
</c:choose>

</div>
<div class="userboxfooter"></div>
</div>

</c:if>
